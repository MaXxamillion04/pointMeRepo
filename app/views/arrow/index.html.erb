<script src='/assets/spin.min.js'></script>
<div id='loading-div'><div id='location-error'></div></div>
<div id='loading'></div>

<script>
    determineDevice();
    navigator.geolocation.getCurrentPosition(updateLocal);
    initIndex("<%= @reciever_mid %>", "<%= Rails.application.secrets.mobile_api_key %>", "<%= @new_requests.length %>", "<%= @currently_running.length %>", "<%= @sponsored.length %>");
</script>

<div id='top-div' class='top-div'>
    <div class='req-inner'>
        <div class="dropdown">
            <img src='/assets/bubbles.png' class="dropdown-toggle col-xs-offset-3" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <h9><li><a href="/">Home</a></li></h9>
            </ul>
        </div>
    </div>
    <div class='req-inner'>
        <div class="text-center">
            <h9>Archer</h9>
        </div>
    </div>
    <div class='req-inner'>
        <div class="dropdown">
            <img src='/assets/bubbles.png' class=" dropdown-toggle col-xs-offset-6" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                <h9><li><a href="/">Home</a></li></h9>
            </ul>
        </div>
    </div>
</div>

<div id='download' class='download-div'>
    <div class='inner-download'>
        <p class='col-xs-11'><h12>Want to send arrows to your friends and get more accurate location readings?</h12></p>
        <button class='close-download' onclick='$("#download").remove();'><img src='/assets/x.png' height='60px' width='60px'></button>
        <p class='col-xs-11'><h12>Click here to download our mobile app!</h12></p>
    </div>
</div>

<div id='new-req-title'></div>

<div id='new-req'>
    <% 
        count = 0
        @new_requests.each { |req| 
            %>
                <div id= '<%= count.to_s %>-outer'>
                    <div id='<%= count.to_s %>' class='new-req'>
                        <div class='req-inner req-name'>
                            <div id ='<%= count.to_s %>-inner'>
                                <div class="col-xs-offset-1"><h9><%= req["sender_name"] %></h9></div>
                            </div>
                        </div>
                        <div class='req-inner'>
                            <img id='<%= count.to_s %>-approve' src='<%= image_tag('approve-smaller') %>' onclick='approve("<%= count.to_s %>", 
                                                                                                    "<%= @reciever_mid %>", 
                                                                                                    "<%= req["aid"] %>", 
                                                                                                    "<%= req["sender_mid"] %>",
                                                                                                    "<%= req["sender_name"] %>",
                                                                                                    "<%= req["deathtime"] %>")'>

                            <img id='<%= count.to_s %>-deny' class='col-xs-offset-1' src='/assets/deny_smaller.png' onclick='deny("<%= count.to_s %>", 
                                                                                                                        "<%= req["aid"] %>")'>
                        </div>
                    </div>
                </div>
            <%
            count += 1
        }
    %>
</div>

<div id='running-req-title' class='req-title'>
    <div class='req-inner'>
        <h10 class='col-xs-offset-1'>CURRENTLY RUNNING</h10>
    </div>
</div>

<div id='running-req'>
    <% 
        @currently_running.each { |req| 
            %>
                <div id='<%= count.to_s %>' class='running-req'>
                    <div class= 'req-inner req-name' onclick='showArrow("<%= @reciever_mid %>", "<%= req["sender_name"] %>", "<%= req["sender_mid"] %>", "<%= req["deathtime"] %>")'>
                        <div class='col-xs-offset-1'><h9><%= req["sender_name"] %></h9></div><br>
                            <div>
                                <h11>
                                    <div id='<%= count.to_s %>-distance' class='col-xs-6'><img class='col-xs-offset-1' src='/assets/distance_icon.png'></div><div id='<%= count.to_s %>-hours'><img class='col-xs-offset-1' src='/assets/time_icon.png'> <%= req["hours_left"] %></div>
                                </h11>
                            </div>
                    </div>
                    <div class='req-inner' onclick='deleteArrow("<%= count.to_s %>","<%= req["aid"] %>")'>
                         <%= image_tag('delete_smaller.png', :class => 'col-xs-offset-5') %>
                    </div>
                </div>
                <script>calculateIndexDistance("<%= req["sender_mid"] %>", "<%= count.to_s %>", "user");</script>
            <%
            count += 1

        }
    %>
</div>

<div id='sponsored-req-title'></div>

<div id='sponsored-req'>
    <% 
        @sponsored.each { |req| 
            %>
                <div id='<%= count.to_s %>' class='sponsored-req' onclick='showPlace("<%= req["pid"] %>", "<%= @reciever_mid %>")'>
                    <div class= 'req-inner req-name'>
                        <div class='col-xs-offset-1'><h9><%= req["name"] %></h9></div><br>
                            <div>
                                <h11>
                                    <div id='<%= count.to_s %>-distance' class='col-xs-6'><img class='col-xs-offset-1' src='/assets/distance_icon.png'></div><div id='<%= count.to_s %>-hours'><img class='col-xs-offset-1' src='/assets/time_icon.png'> <%= req["hours_left"] %></div>
                                </h11>
                            </div>
                    </div>
                    <div class='req-inner'>
                        <img class='col-xs-offset-5' src='/assets/sponsored.png'>
                    </div>
                </div>
                <script>
                    calculateIndexDistance("<%= req["pid"] %>", "<%= count.to_s %>", "place");
                </script>
            <%
            count += 1
            
        }
    %>
</div>

<script>
    window.onload = initializeDivs();
</script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

